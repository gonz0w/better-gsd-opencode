# External Integrations

**Analysis Date:** 2026-02-26

## APIs & External Services

**Brave Search API (Optional):**
- Purpose: Web search for research phases and decision-making
- Implementation: `src/commands/misc.js` (`cmdWebsearch`, line 1136)
- Endpoint: `https://api.search.brave.com/res/v1/web/search`
- Auth: `BRAVE_API_KEY` env var or `~/.gsd/brave_api_key` file
- Config toggle: `brave_search` in `.planning/config.json`
- Auto-detected during config initialization: `src/commands/misc.js` (line 124), `src/commands/init.js` (line 419)
- Uses Node.js built-in `fetch()` (no HTTP library dependency)
- Graceful degradation: Returns `{ available: false }` when no API key — agent falls back to built-in web search

**No other external APIs.** The tool is fully offline-capable. All core functionality operates on local files and git.

## Data Storage

**File System (Primary):**
- All data stored as Markdown and JSON in `.planning/` directory within each project
- Key files:
  - `.planning/STATE.md` — Project state (current phase, position, activity log)
  - `.planning/ROADMAP.md` — Phase roadmap with milestone tracking
  - `.planning/INTENT.md` — Project intent document
  - `.planning/REQUIREMENTS.md` — Requirements traceability
  - `.planning/ASSERTIONS.md` — Acceptance criteria
  - `.planning/config.json` — Project configuration
  - `.planning/phases/NN-name/` — Phase directories with PLAN.md, SUMMARY.md, etc.
  - `.planning/memory/` — Persistent memory stores (JSON: decisions, bookmarks, lessons, todos)
  - `.planning/milestones/` — Archived milestone phases
  - `.planning/codebase/codebase-intel.json` — Cached codebase analysis data

**Memory Stores:**
- Implementation: `src/commands/memory.js`
- Location: `.planning/memory/` directory
- Format: Newline-delimited JSON (NDJSON) — one JSON object per line
- Stores: `decisions.jsonl`, `bookmarks.jsonl`, `lessons.jsonl`, `todos.jsonl`
- Sacred data (decisions, lessons): Never compacted or pruned
- Bookmarks: Prepend newest first, trim to max 20
- Compaction: `memory compact` command for non-sacred stores

**Environment Manifests:**
- `.planning/env-manifest.json` — Machine-specific (gitignored)
- `.planning/project-profile.json` — Team-visible (committed)
- Generated by: `src/commands/env.js` (`cmdEnvScan`)

**Databases:**
- None — Pure file-based storage

**Caching:**
- In-memory caches per CLI invocation (file, directory, frontmatter, regex, config, milestone, phase tree)
- `codebase-intel.json` — Persistent on-disk cache with git-commit-hash watermark for incremental updates

## Git Integration (Critical)

**Git is the most important external integration.** Nearly every command interacts with git.

**Git Execution:**
- Implementation: `src/lib/git.js` (`execGit` function)
- Method: `execFileSync('git', args)` — no shell spawning for security and performance
- All git commands run in the target project's `cwd`

**Git Operations Used:**
- `git log` — Session diff, commit history, velocity calculation
- `git diff` — Change detection, file-level diffs
- `git rev-parse` — HEAD hash, branch name, repo root detection
- `git check-ignore` — Respect .gitignore for source directory scanning
- `git add` / `git commit` — Auto-commit planning documents
- `git worktree` — Parallel plan execution (create, list, remove, prune)
- `git branch` — Worktree branch management

**Git Worktree Support:**
- Implementation: `src/commands/worktree.js` (791 lines)
- Purpose: Isolated git worktrees for parallel plan execution
- Default base path: `/tmp/gsd-worktrees`
- Config: `worktree` section in `.planning/config.json`
- Branch naming: `worktree-{phase}-{plan}-{wave}`
- File sync: Copies `.env`, `.env.local`, `.planning/config.json` to worktree

**Planning Document Commits:**
- Implementation: `src/commands/misc.js` (`cmdCommit`)
- Auto-commit behavior: Controlled by `commit_docs` config (default: `true`)
- Scope: `.planning/` directory changes only (by default)
- Supports `--amend` and `--files` for targeted commits

## Test Framework Detection

**Multi-framework test runner:** `src/commands/features.js` (`cmdTestRun`) and `src/commands/verify.js`
- Auto-detects test framework from project manifest files:
  - `package.json` → `npm test`
  - `mix.exs` → `mix test`
  - `go.mod` → `go test ./...`
- Override via `test_commands` in `.planning/config.json`
- Parses output from ExUnit, Go test, and pytest formats
- Test gating: `test_gate` config blocks plan completion on test failure

## Environment Detection

**Project environment scanner:** `src/commands/env.js` (1,177 lines)

Detects and catalogs:
- **26 language manifests:** `package.json`, `go.mod`, `mix.exs`, `Cargo.toml`, `pyproject.toml`, `setup.py`, `Gemfile`, `composer.json`, `build.gradle`, `pom.xml`, `Package.swift`, `CMakeLists.txt`, `Dockerfile`, `deno.json`, `bun.lockb`, etc.
- **Package managers:** npm, pnpm, yarn, bun, mix, cargo, bundler, poetry, pipenv (lockfile precedence detection)
- **Version managers:** asdf, mise, nvm, pyenv, rbenv, goenv
- **CI platforms:** GitHub Actions, GitLab CI, CircleCI, Jenkins, Travis
- **Binary availability:** Checks if language runtimes are installed (version + path)

## Codebase Analysis Engine

**Multi-language source analysis:** `src/lib/codebase-intel.js` (529 lines)

- Auto-detects source directories (respects `.gitignore` via git)
- Walks file trees, analyzes per-file: language, lines, size, mtime
- Language detection: 40+ extensions mapped in `LANGUAGE_MAP`
- Incremental mode: Git-commit-hash watermark for delta updates
- Staleness detection: Git-based (preferred) or mtime-based (fallback)

**Import/dependency parsing:** `src/lib/deps.js` (697 lines)

Parsers for 5 languages:
- **JavaScript/TypeScript:** `require()`, `import from`, `import()`, `export from`
- **Python:** `import X`, `from X import Y`, relative imports
- **Go:** `import "path"`, grouped `import ( ... )` blocks
- **Elixir:** `alias`, `import`, `use`, `require`, multi-alias `Module.{A, B}`
- **Rust:** `use crate::`, `mod`, `extern crate`

Resolvers map import specifiers → actual project files. Builds forward/reverse dependency graphs. Tarjan's SCC algorithm for cycle detection. BFS for transitive impact analysis.

**Convention detection:** `src/lib/conventions.js` (644 lines)

- File naming pattern classification (camelCase, PascalCase, snake_case, kebab-case)
- File organization detection (flat vs nested, by-type vs by-feature)
- Test placement detection (co-located vs separate directory)
- Extensible framework detector registry (currently: Elixir/Phoenix)

## MCP Server Profiling

**MCP (Model Context Protocol) server discovery and profiling:** `src/commands/mcp.js` (405 lines)

- Discovers MCP servers from: `.mcp.json`, `opencode.json`, `~/.config/opencode/opencode.json`
- Known server database: 19 servers (postgres, github, brave-search, context7, terraform, docker, redis, rabbitmq, pulsar, consul, vault, sqlite, puppeteer, slack, linear, notion, sentry, datadog, filesystem)
- Token cost estimation per server
- Relevance scoring based on project file indicators
- Can `--apply` to disable low-relevance servers (modifies `opencode.json` with backup)
- Can `--restore` from backup

## OpenCode Integration

**Target platform:** OpenCode (AI coding assistant, similar to Claude Code)

- Deployment location: `~/.config/opencode/get-shit-done/`
- Workflows (`.md` files): Loaded as agent prompts by OpenCode
- Commands: Defined in `~/.config/opencode/command/` (thin wrappers)
- Agents: Defined in `~/.config/opencode/agents/` (subagent system prompts)
- Hooks: `~/.config/opencode/hooks/` (statusline, update checks)
- The CLI tool is invoked by agents via `gsd-tools <command> --raw` to get structured JSON

**Model profile resolution:**
- Agent types: `gsd-planner`, `gsd-executor`, `gsd-verifier`, `gsd-codebase-mapper`, etc. (11 agent types)
- Profile tiers: `quality` (opus), `balanced` (sonnet), `budget` (haiku)
- Defined in: `src/lib/constants.js` (`MODEL_PROFILES`)
- Per-agent overrides via `model_overrides` in config

## User-Level Configuration

**Global settings location:** `~/.gsd/`
- `~/.gsd/defaults.json` — Default config values applied to new projects
- `~/.gsd/brave_api_key` — Brave Search API key (file-based alternative to env var)

## Webhooks & Callbacks

**Incoming:** None
**Outgoing:** None (except optional Brave Search API calls)

## Authentication & Identity

**Auth Provider:** None
- No user authentication system
- Brave Search uses API key (env var or file)
- Git operations use system git credentials

## Monitoring & Observability

**Error Tracking:** None (external)
**Debug Logging:** `GSD_DEBUG` env var → stderr output via `debugLog()` in `src/lib/output.js`
**Bundle Size Tracking:** Build writes size record to `.planning/baselines/bundle-size.json`
**Quality Scores:** Stored in `.planning/memory/quality-scores.json` for trend tracking

## CI/CD & Deployment

**CI Pipeline:** None detected in this repository
**Deployment:** Manual via `./deploy.sh` (bash script with backup + smoke test + rollback)
**Hosting:** Local CLI tool — runs on developer machines only

---

*Integration audit: 2026-02-26*
