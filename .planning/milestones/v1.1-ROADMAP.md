# Milestone v1.1: Context Reduction & Tech Debt

**Status:** SHIPPED 2026-02-22
**Phases:** 6-9
**Total Plans:** 10
**Commits:** 42 | **Files changed:** 78 | **Lines:** +12,642 / -4,576
**Timeline:** 2026-02-22 (single day)

## Overview

Reduce token/context consumption across all GSD layers (workflows, CLI output, planning docs, research files) by 30%+ while resolving remaining tech debt from v1.0.

## Phases

### Phase 6: Token Measurement & Output Infrastructure

**Goal**: Developers can accurately measure token consumption across all GSD layers and selectively filter CLI output fields
**Depends on**: Phase 5 (v1.0 complete)
**Plans**: 3 plans

Plans:
- [x] 06-01: Token estimation library (tokenx) + --fields flag [MEAS-01, CLIP-01]
- [x] 06-02: Workflow baseline measurement + @-reference parsing [MEAS-02]
- [x] 06-03: Before/after comparison + help text [MEAS-03]

**Details:**
- Installed tokenx@1.3.0 for accurate BPE-based token estimation (~96% accuracy, 4.5KB bundled)
- Replaced broken `lines*4` heuristic in context-budget with real token counts
- Added `--fields` global flag for all JSON commands with dot-notation and array support
- Built `measureAllWorkflows()` scanning 43 workflow files including @-referenced files
- Baseline/compare subcommands for before/after token measurement

### Phase 7: Init Command Compaction

**Goal**: Init commands return significantly smaller payloads when agents don't need full data, with manifests guiding what to load
**Depends on**: Phase 6 (needs `--fields` infrastructure and baselines for measurement)
**Plans**: 3 plans

Plans:
- [x] 07-01: --compact flag + compact profiles for all 12 init commands [CLIP-02]
- [x] 07-02: Context manifests in compact mode [CLIP-03]
- [x] 07-03: Split --manifest from --compact to meet 38% reduction target [CLIP-02, CLIP-03]

**Details:**
- All 12 init commands accept `--compact` flag returning essential-only data (46.7% avg reduction)
- Dynamic `_manifest.files` with path/sections/required for selective context loading
- Split into `--compact` (fields only) and `--manifest` (opt-in guidance) to eliminate manifest overhead
- All 12 commands exceed 38% reduction threshold without manifest overhead

### Phase 8: Workflow & Reference Compression

**Goal**: Workflow prompts and reference files consume significantly fewer tokens while preserving agent behavior quality
**Depends on**: Phase 7 (compressed workflows should use `--compact` init calls and `--fields` filtering)
**Plans**: 3 plans

Plans:
- [x] 08-01: extract-sections CLI command + section markers on reference files [WKFL-01, WKFL-02]
- [x] 08-02: Compress top 8 workflows via deduplication, prose tightening, selective loading [WKFL-03]
- [x] 08-03: Research output summary/detail tiers + before/after baseline [WKFL-04]

**Details:**
- Built `extract-sections` with dual-boundary parsing (## headers + <!-- section --> HTML markers)
- Added section markers to 3 reference files (checkpoints.md, verification-patterns.md, continuation-format.md)
- Compressed 8 largest workflows: 54.6% avg token reduction (39,426 to 15,542 tokens)
- Added compact tiers to all 6 research templates for context-aware loading
- Top 6 workflow avg reduction -35.7% exceeds 30% target

### Phase 9: Tech Debt Cleanup

**Goal**: Pre-existing tech debt items from v1.0 are resolved — broken test fixed, help coverage complete, plan templates created
**Depends on**: Nothing (independent)
**Plans**: 1 plan

Plans:
- [x] 09-01: Fix test, complete help coverage, create generic plan templates [DEBT-01, DEBT-02, DEBT-03]

**Details:**
- Fixed `progress_percent` assertion (50→33 for phase-based metric, added `plan_progress_percent` for plan-based)
- Updated no-command usage string to all 44 commands, alphabetized
- Created execute.md, tdd.md, discovery.md plan templates in `templates/plans/`

---

## Milestone Summary

**Key Decisions:**
- tokenx 1.3.0 for token estimation (4.5KB bundled, ~96% accuracy, zero deps)
- Bundle npm deps via esbuild (ESM→CJS conversion works automatically)
- Layered reduction strategy: measure → CLI output → workflows → templates
- --compact profiles drop model names, commit_docs, static paths, redundant booleans
- Split --compact into field reduction + opt-in --manifest for guidance
- Section markers use HTML comments — invisible to rendering, machine-parseable
- Research templates use compact XML tags as default planner view
- Prose tightening: imperative instructions over verbose explanations for AI agents

**Issues Resolved:**
- Broken `roadmap analyze` test (expected 50%, got 33% — fixed assertion)
- 36 commands missing `--help` text (all 44 now complete)
- Missing plan template files (3 generic templates created)
- Manifest overhead causing compact output to be LARGER for some commands (split into opt-in flag)

**Issues Deferred:**
- Progressive workflow step loading (ACTX-01 — deferred to future milestone)
- Automated workflow regression testing (ACTX-02 — deferred to future milestone)
- Exact BPE token counting via gpt-tokenizer (ACTX-03 — deferred, tokenx sufficient)
- Default --compact mode (ACTX-04 — breaking change, needs migration period)

**Technical Debt Incurred:**
None. All pre-existing v1.0 tech debt was resolved in Phase 9.

---

_For current project status, see .planning/ROADMAP.md_
